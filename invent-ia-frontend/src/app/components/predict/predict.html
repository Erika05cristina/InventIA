<div class="predict-container">

  <!-- Encabezado general con descripción -->
  <div class="predict-header">
    <h2>Predicciones</h2>
    <p>
      En esta sección puedes obtener predicciones automáticas sobre las cantidades de productos necesarias, de forma individual o grupal, para una fecha determinada.
    </p>
  </div>

  <!-- Bloque de predicción individual -->
  <div class="prediction-section">
    <h3>Predicción individual</h3>
    <div class="input-row">
      <label>
        ID del producto:
        <input type="number" [(ngModel)]="manualProductIdValue" />
      </label>

      <label>
        Fecha:
        <input type="date" [(ngModel)]="manualFechaValue" />
      </label>

      <button (click)="getPrediction()">Predecir</button>
    </div>

    <!-- Loader individual -->
    @if (isPredictingIndividual()) {
      <div class="loader-box loader-predict">
        <span class="spinner"></span>
        <p>Procesando predicción individual...</p>
      </div>
    }

    <!-- Resultado predicción individual -->
    @if (predictionResult()) {
      <div class="prediction-box">
        <h4>Resultado:</h4>
        <ul>
          @for (r of predictionResult(); track r.productId) {
            <li>
              Producto #{{ r.productId }} — {{ r.date }}:
              <strong>{{ r.prediction }}</strong>
            </li>
          }
        </ul>
      </div>
    }
  </div>

  <!-- Bloque de predicción grupal -->
  <div class="prediction-section">
    <h3>Predicción grupal</h3>
    <div class="input-row">
      <label>
        Fecha:
        <input type="date" [(ngModel)]="fecha" />
      </label>

      <button (click)="getGroupPrediction()">Predecir grupo</button>
    </div>

    <!-- Loader grupal -->
    @if (isPredictingGroup()) {
      <div class="loader-box loader-predict">
        <span class="spinner"></span>
        <p>Procesando predicción grupal...</p>
      </div>
    }

    <!-- Mensaje éxito grupal -->
    @if (wasGroupPredictionDownloaded()) {
      <div class="loader-box loader-predict">
        <span class="material-symbols-rounded">download_done</span>
        <p>Predicción descargada correctamente</p>
      </div>
    }
  </div>

  <!-- Filtros y tabla de resultados grupales -->
@if (groupPrediction()) {
  <div class="prediction-group-result">

    <!-- Filtros -->
    <div class="filter-row">
      <label>
        Categoría:
        <select [(ngModel)]="selectedCategoriaValue">
          <option value="">Todas</option>
          @for (cat of categorias(); track cat) {
            <option [value]="cat">{{ cat }}</option>
          }
        </select>
      </label>

      <label *ngIf="productosFiltrados().length > 0">
        Producto:
        <select [(ngModel)]="selectedProductoValue">
          <option [ngValue]="null">Todos</option>
          @for (prod of productosFiltrados(); track prod) {
            <option [value]="prod">{{ prod }}</option>
          }
        </select>
      </label>

      <!-- Tamaño de página -->
      <label>
        Tamaño de página:
        <select [(ngModel)]="pageSizeValue">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
        </select>
      </label>
    </div>

    <!-- Tabla de predicciones -->
    <div class="table-container" *ngIf="paginatedPredictions().length > 0">
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categoría</th>
            <th>Stock</th>
            <th>Precio</th>
          </tr>
        </thead>
        <tbody>
          @for (p of paginatedPredictions(); track p.product_id) {
            <tr>
              <td>{{ p.name }}</td>
              <td>{{ p.categoria }}</td>
              <td>{{ p.predicted_stock }}</td>
              <td>{{ p.precio | currency }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Controles de paginación -->
    <div class="pagination-controls">
      <button (click)="prevPage()" [disabled]="currentPage() === 1">Anterior</button>
      <span>Página {{ currentPage() }} de {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage() === totalPages()">Siguiente</button>
    </div>

    <!-- Total inversión -->
    <div class="inversion-box">
      <strong>Inversión total:</strong> {{ groupPrediction()?.inversion | currency }}
    </div>

  </div>
}

</div>